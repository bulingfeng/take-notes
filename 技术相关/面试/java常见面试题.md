## 父子线程之间如何进行共享数据的传递

1. 使用concurrenthashmap来作为中间保存对象的媒介，然后通过key来进行传递。
2. 使用InheritableThreadLocal
3. 使用一些ArrayBlockingQueue来进行传递。

## java中如何安全优雅的停止线程

使用volatile关键字的标志位

## Java中读写锁的应用场景是什么

适用于读多写少的情况下。

1. 多个人协同编辑文档。
2. 缓存的处理场景，读多写少。

## 什么是伪共享问题以及如何解决

https://www.cnblogs.com/cyfonly/p/5800758.html

## Cas的实现与原理

compare-and-swap，是一种用于多线程的原则操作，它通过硬件指令来实现和锁一样的效果，是一种乐观锁的表现。

内存位置的value,预期值value，新值value。如果内存位置的value和预期值的value是一样的则认为可以更新，于是把新值给更新掉。

## JDK21中的虚拟线程是怎么回事

什么是虚拟线程

- 轻量级线程；虚拟线程不同于传统的java平台线程是映射在操作系统内核线程的。
- 调度和管理；虚拟线程是由jvm调度和管理的，而不是依赖于操作系统的调度机制，这使得虚拟线程的创建和销毁成本变的很低。
- 并发模型简化；因为虚拟线程轻量可以创建大量线程

## Synchronized和ReentrantLock的区别



## 什么是阻塞队列以及应用场景

阻塞队列是一个支持线程安全的队列接口，可以实现在插入和移除元素的进行阻塞功能。适用与生产者消费者之间的信息同步和多线程之间的数据传递。

## Http和RPC的区别

Http是一种应用层的协议，主要强调的是网络通讯。

RPC指的是远程调用，是一种分布式系统之间的通讯协议，强调的是服务之间的远程调用。

如果HTTP来用做服务之间的远程调用，如果从分布式架构调用来理解这也是PRC。其实只要是能够实现分布式的远程调用都可以算作RPC，就当然使用哪种协议是另一回事了。

### 负载均衡的算法有哪些

1. 轮询
2. 加权轮询；
3. 随机
4. 加权随机
5. 最少连接
6. hash

## CAP原则和BASE原则怎么理解

CAP原则是指一个分布式系统中，最多能够满足其中的两个条件；

C-consistency(一致性)，所有的节点在任何时间都具有相同的数据；

A-availability(可用性)，能够保持可用性

Partiton Tolerance-分区容错性，指的是分布式节点中某些网络分区之间无法通讯的情况；比如河南的网络和上海的网络。

实际应用中p是不可避免的，所以只能在c和a之间做选择，也就是cp或者ap来做选择。

Base原则

Basically Available 基本可用；系统出现故障保证核心可用，允许损失部分功能；

Soft state 软状态；允许数据出现中间状态，并认为该状态不会影响整体的可用性；

Eventrually consistent 最终一致性;系统重所有的数据副本经过一段时间以后，最终到达一致性的状态。

## ThreadLoal的内存泄露问题

key的内存泄露

1. 因为ThreadLocalMap是以thradlocal作为key的；如果threadlocal被设置为null而失去引用，这个时候线程还没有运行结束，如果是key是强引用那么则会出现ThreadLocal对象无法被回收；如果key是弱引用这可以进行回收。

value的泄露

如果线程一直没有结束，特别是线程池的情况下，这个时候线程的引用会一直应用ThreadLocalMap，而key如果因为threadlocal被回收而被回收，这个value是找不到的，这个时候也会造成内存泄露。

## 什么是AQS

AbstractQueueSynchronizer是一个抽象类，其中有一个state成员变量，是被volalite的关键字给修饰，并且是通过cas的方式来进行修改。

Reentrantlock也是根据state来判断当前线程是否持有当前的锁。`Thread exclusiveOwnerThread`这个成员变量就是代表了是哪个现场独占这个锁的。

同时AQS还是由一个双向的链表组成，其中的node节点包含了一些信息，比如是否是独占锁，还有一些状态，比如取消之类的，还有线程信息。

没有拿到锁的资源使用addWaiter添加到队列当中，是通过cas+死循环的方式来把节点添加到最后的节点。

如果是被执行了等待方法await方法的线程会被添加到ConditionObject中的链表中。



